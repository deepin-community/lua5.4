From 09a7443d97ee2ef85c65fe78d44342276e2c21dc Mon Sep 17 00:00:00 2001
From: zengwei <zengwei1@uniontech.com>
Date: Tue, 27 Jan 2026 17:17:08 +0800
Subject: [PATCH] CVE-2021-45985

---
 src/ldo.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/ldo.c b/src/ldo.c
index 7135079..9261cff 100644
--- a/src/ldo.c
+++ b/src/ldo.c
@@ -483,9 +483,9 @@ void luaD_pretailcall (lua_State *L, CallInfo *ci, StkId func, int narg1) {
   int fsize = p->maxstacksize;  /* frame size */
   int nfixparams = p->numparams;
   int i;
+  checkstackGCp(L, fsize - delta, func);
   for (i = 0; i < narg1; i++)  /* move down function and arguments */
     setobjs2s(L, ci->func + i, func + i);
-  checkstackGC(L, fsize);
   func = ci->func;  /* moved-down function */
   for (; narg1 <= nfixparams; narg1++)
     setnilvalue(s2v(func + narg1));  /* complete missing arguments */
-- 
2.20.1

